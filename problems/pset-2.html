<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Problem Set 2 – STA 542 Fall 2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7ad8df1012cc34949a7a0ac4d54234c8.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-7e3fde4f3f6223aa5a1e65c779016629.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Problem Set 2 – STA 542 Fall 2025">
<meta property="og:description" content="Due Monday October 6 at 11:30 AM">
<meta property="og:image" content="https://sta542-f25.github.io/problems/pset-2_files/figure-html/unnamed-chunk-1-1.png">
<meta property="og:site_name" content="STA 542 Fall 2025">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
</head>
<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Problem Set 2</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../img/logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus/syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Problem Sets</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../problems/pset-0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 0</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../problems/pset-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probem Set 1</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#problem-1" id="toc-problem-1" class="nav-link active" data-scroll-target="#problem-1">Problem 1</a></li>
  <li><a href="#problem-2" id="toc-problem-2" class="nav-link" data-scroll-target="#problem-2">Problem 2</a></li>
  <li><a href="#problem-3" id="toc-problem-3" class="nav-link" data-scroll-target="#problem-3">Problem 3</a></li>
  <li><a href="#problem-4" id="toc-problem-4" class="nav-link" data-scroll-target="#problem-4">Problem 4</a></li>
  <li><a href="#problem-5" id="toc-problem-5" class="nav-link" data-scroll-target="#problem-5">Problem 5</a></li>
  <li><a href="#problem-6" id="toc-problem-6" class="nav-link" data-scroll-target="#problem-6">Problem 6</a></li>
  <li><a href="#submission" id="toc-submission" class="nav-link" data-scroll-target="#submission">Submission</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Problem Set 2</h1>
<p class="subtitle lead">Due Monday October 6 at 11:30 AM</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="problem-1" class="level2"><h2 class="anchored" data-anchor-id="problem-1">Problem 1</h2>
<p>Consider the mean-zero AR(2):</p>
<p><span class="math display">\[
y_t=\beta_1y_{t-1}+\beta_2y_{t-2}+\varepsilon_t,\quad\varepsilon_t\overset{\text{iid}}{\sim}\text{N}(0,\,\sigma^2).
\]</span></p>
<p>We can rewrite this in state-space form:</p>
<p><span class="math display">\[
\begin{aligned}
y_t&amp;=\begin{bmatrix}1&amp;0\end{bmatrix}\begin{bmatrix}y_t\\y_{t-1}\end{bmatrix}
\\
\begin{bmatrix}y_t\\y_{t-1}\end{bmatrix}
&amp;=
\begin{bmatrix}\beta_1&amp;\beta_2\\1&amp;0\end{bmatrix}
\begin{bmatrix}y_{t-1}\\y_{t-2}\end{bmatrix}
+
\begin{bmatrix}\varepsilon_t\\0\end{bmatrix}
.
\end{aligned}
\]</span></p>
<p>In order for the process to be stationary, the eigenvalues of the companion matrix must all lie inside the unit circle. This happens if and only if the pair <span class="math inline">\((\beta_1,\,\beta_2)\)</span> lies in this region:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="pset-2_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Prove it.</p>
</section><section id="problem-2" class="level2"><h2 class="anchored" data-anchor-id="problem-2">Problem 2</h2>
<p>Consider again the mean-zero AR(2):</p>
<p><span class="math display">\[
y_t=\beta_1y_{t-1}+\beta_2y_{t-2}+\varepsilon_t,\quad\varepsilon_t\overset{\text{iid}}{\sim}\text{N}(0,\,\sigma^2).
\]</span></p>
<p>Assuming the process is stationary, derive concrete formulas for the Yule-Walker estimators of <span class="math inline">\(\beta_1\)</span>, <span class="math inline">\(\beta_2\)</span>, and <span class="math inline">\(\sigma^2\)</span>. To keep the formulas clean, you may find it helpful to introduce notation for the <strong>autocorrelation function</strong> of a stationary process:</p>
<p><span class="math display">\[
\rho(h)=\frac{\gamma(h)}{\gamma(0)}=\frac{\text{cov}(y_{t+h},\,y_t)}{\text{var}(y_t)}=\text{cor}(y_{t+h},\,y_t).
\]</span></p>
</section><section id="problem-3" class="level2"><h2 class="anchored" data-anchor-id="problem-3">Problem 3</h2>
<p><a href="https://sta542-f25.github.io/problems/pset-1.html#problem-5">Last time</a>, you derived a recursive updating rule for conjugate Bayesian linear regression. The recursion for the posterior mean of the regression coefficients is</p>
<p><span class="math display">\[
\newcommand{\tr}{{\scriptscriptstyle\mathsf{T}}}
\begin{aligned}
\mathbf{k}_t&amp;=\frac{\mathbf{H}_{t-1}^{-1}\mathbf{x}_t}{1+\mathbf{x}_t^\tr\mathbf{H}_{t-1}^{-1}\mathbf{x}_t}
\\
\mathbf{m}_t
&amp;=
\mathbf{m}_{t-1}
+
\mathbf{k}_t(y_t-\mathbf{x}_t^\tr\mathbf{m}_{t-1})
.
\end{aligned}
\]</span></p>
<p>That vector <span class="math inline">\(\mathbf{k}_t\)</span> is sometimes called the <strong>Kalman gain</strong>. You probably derived this using purely linear algebraic ideas like the Sherman-Morrison formula, but in fact the form of this recursion has important probabilistic meaning as well.</p>
<p>Imagine you are taking a conjugate Bayesian approach to fitting a Gaussian AR(p). After observing the first <span class="math inline">\(t-1\)</span> observations, here is where things stand:</p>
<p><span class="math display">\[
\begin{aligned}
\sigma^2\,|\, y_{1:t-1}
&amp;\sim
\text{IG}(a_{t-1},\, b_{t-1})
\\
\boldsymbol{\beta}\,|\, \sigma^2,\, y_{1:t-1}
&amp;\sim
\text{N}_{p+1}(\mathbf{m}_{t-1},\,\sigma^2\mathbf{H}^{-1}_{t-1})\\
y_t\,|\,\boldsymbol{\beta},\,\sigma^2,\, y_{1:t-1}
&amp;\sim\text{N}(\mathbf{x}_t^{\scriptscriptstyle\mathsf{T}}\boldsymbol{\beta},\,\sigma^2) &amp;&amp;
\mathbf{x}_t=\begin{bmatrix}1&amp;y_{t-1}&amp;\cdots &amp;y_{t-p}\end{bmatrix}^{\scriptscriptstyle\mathsf{T}}.
\end{aligned}
\]</span></p>
<ol type="a">
<li>Using results from <a href="https://sta542-f25.github.io/problems/pset-0.html">Problem Set 0</a>, show that the joint distribution of <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(y_t\)</span> is multivariate normal, and state the moments:</li>
</ol>
<p><span class="math display">\[
\begin{bmatrix}
\boldsymbol{\beta}\\
y_{t}
\end{bmatrix}
\,|\,\sigma^2,\,y_{1:t-1}
\sim
\text{N}_{p+2}
\left(?,\,?\right)
\]</span></p>
<ol start="2" type="a">
<li><p>Using part a and standard results for the conditional distributions of multivariate normals, what is the conditional posterior <span class="math inline">\(p(\boldsymbol{\beta}\,|\,\sigma^2,\,y_{1:t})\)</span>?</p></li>
<li><p>Using part b, what is the <em>probabilistic</em> interpretation of the Kalman gain <span class="math inline">\(\mathbf{k}_t\)</span>?</p></li>
</ol></section><section id="problem-4" class="level2"><h2 class="anchored" data-anchor-id="problem-4">Problem 4</h2>
<p>Recall the mean-zero MA(q):</p>
<p><span class="math display">\[
y_t
=
\sum_{i=1}^q\theta_i\varepsilon_{t-i}
+
\varepsilon_t,
\quad
\varepsilon_t
\overset{\text{iid}}{\sim}
\text{N}(0,\, \sigma^2)
.
\]</span></p>
<p>It is useful to write this in the form of a linear state-space system:</p>
<p><span class="math display">\[
\begin{aligned}
y_t
&amp;=
\mathbf{F}\mathbf{s}_t
+
\mathbf{Q}\boldsymbol{\varepsilon}_t
\\
\mathbf{s}_t
&amp;=\mathbf{G}
\mathbf{s}_{t-1}
+
\mathbf{R}\boldsymbol{\eta}_t
\end{aligned}
\]</span></p>
<p>For better or worse, there are many equivalent ways to do this depending on what you think of as the “state,” and they all have their uses:</p>
<ol type="a">
<li>
<span class="math inline">\(\mathbf{s}_t=\begin{bmatrix}\varepsilon_t &amp; \varepsilon_{t-1}&amp;\cdots &amp; \varepsilon_{t-q}\end{bmatrix}^{\scriptscriptstyle\mathsf{T}}\in\mathbb{R}^{q+1}\)</span>;</li>
<li>
<span class="math inline">\(\mathbf{s}_t=\begin{bmatrix}\sum\limits_{i=0}^q\theta_i\varepsilon_{t-i} &amp; \sum\limits_{i=1}^q\theta_i\varepsilon_{t-i+1}&amp;\cdots&amp;\theta_q\varepsilon_t\end{bmatrix}^{\scriptscriptstyle\mathsf{T}}\in\mathbb{R}^{q+1}\)</span>;</li>
<li>
<span class="math inline">\(\mathbf{s}_t=\begin{bmatrix}y_t-\varepsilon_t &amp; y_{t-1}-\varepsilon_{t-1}&amp;\cdots &amp; y_{t-q+1}-\varepsilon_{t-q+1}\end{bmatrix}^{\scriptscriptstyle\mathsf{T}}\in\mathbb{R}^q\)</span>;</li>
</ol>
<p>For each version of the state vector, figure out what the system components need to be in order for the state-space system to be equivalent to the MA(q). Some of the objects in the system might be unnecessary and you can set them to zero.</p>
</section><section id="problem-5" class="level2"><h2 class="anchored" data-anchor-id="problem-5">Problem 5</h2>
<p>The <code>ARMAacf</code> function in base <code>R</code> computes the autocorrelation function <span class="math inline">\(\rho(h)=\gamma(h)/\gamma(0)\)</span> for the ARMA(p, q) model. Here I’ve wrapped it in a helper that creates a plot:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># plot the autocorrelation function of an ARMA</span></span>
<span><span class="va">plot_arma_acf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">ma</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">lag.max</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">y_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ARMAacf.html">ARMAacf</a></span><span class="op">(</span>ar <span class="op">=</span> <span class="va">ar</span>, ma <span class="op">=</span> <span class="va">ma</span>, lag.max <span class="op">=</span> <span class="va">lag.max</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="va">lag.max</span>, <span class="va">y_vals</span>, pch <span class="op">=</span> <span class="fl">19</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>       xlab <span class="op">=</span> <span class="st">"h"</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">rho</span><span class="op">~</span><span class="st">"(h)"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="va">lag.max</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">:</span><span class="va">lag.max</span>, <span class="va">y_vals</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So there you go. John Zito did something nice for once. But unfortunately, his evil twin Zohn Jito is back making ridiculous demands. He visits your office in an unhinged frenzy. Much like <a href="https://youtu.be/aCPkvtCsD2k?si=fieRy0INnI6lBMqT">Klytaemnestra</a> in Strauss’s opera <em>Elektra</em>, his sleep has been troubled (“Ich habe keine guten Nächte”). He has been haunted by feverish dreams of autocorrelation functions, but he knows not from whence they came. Dripping with sweat, he pants:</p>
<ol type="1">
<li>“The autocorrelations start high, but then shrink smoothly and monotonically toward zero, without changing sign. It feels like each step of the series only remembers the last one, nothing more complicated.”</li>
<li>“The correlations seem to alternate signs: positive, then negative, then positive again. They get smaller each time, kind of like a ringing bell that fades away.”</li>
<li>“The correlations are definitely there at lag 1, a little bit at lag 2, but after that it looks like nothing. Totally flat.”</li>
<li>“At lag 1 the correlation is negative, but then it’s pretty much gone. Looks like it bounces once and stops.”</li>
<li>“The autocorrelations stick around forever. They go down, but it’s painfully slow, like the series doesn’t want to forget the past. It looks borderline nonstationary.”</li>
<li>“There’s a big spike at lag 1, smaller at lag 2, then it tails off smoothly. It’s not a clean cut-off, but it doesn’t oscillate either.”</li>
<li>“Lag 1 correlation is very strong, lag 2 is still positive but smaller, and then they slowly decay. No sign changes. The series is persistent, but it looks like the short-term correlation is extra strong compared to the long-term tail.”</li>
<li>“At lag 1 it’s negative, lag 2 bounces back positive, then it decays but stays positive after that.”</li>
<li>“It’s not a smooth oscillation like a sine wave, but the correlations jump positive, negative, positive for a few lags before dying off.”</li>
<li>“There’s one big spike at lag 1, maybe a tiny one at lag 2, and then nothing.”</li>
<li>“First correlation positive, second negative, third positive but small, then basically gone.”</li>
<li>“The decay is slower than I’d expect for an MA, but the lag-1 correlation isn’t as huge as in an AR(1). It’s like a compromise between short-term and long-term memory.”</li>
<li>“The first few correlations are really high and fluctuate a little in sign, then they slowly die away like a bell fading in a canyon. It’s more complicated than the simple sine-wave oscillation.”</li>
<li>“Correlations die very quickly after lag 3, but the first three lags don’t decrease monotonically—they bounce around a bit.”</li>
<li>“The series looks nearly like white noise. Most of the correlations are tiny, but if you squint you can see a barely-there persistence beyond lag 5 or 6.”</li>
<li>“Some of the lags alternate in sign, others don’t. It’s not a simple sine wave, more like a complicated dance that fades gradually.”</li>
<li>“Lag 1 correlation is negative and quite strong, then lag 2 is barely positive, then the series remembers the past moderately for several lags.”</li>
</ol>
<p>Help bring this poor man some relief! Play around with different values of <span class="math inline">\(p\)</span>, <span class="math inline">\(q\)</span>, and the model parameters until you get an autocorrelation function that matches each description.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Just do ten
</div>
</div>
<div class="callout-body-container callout-body">
<p>Respond to ten of the statements for full credit, but play around with all of them to prepare for the midterm.</p>
</div>
</div>
</section><section id="problem-6" class="level2"><h2 class="anchored" data-anchor-id="problem-6">Problem 6</h2>
<p>The <code>arima.sim</code> function in base <code>R</code> does exactly what it says it does. Feel free to read the <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/arima.sim.html">documentation</a>. Furthermore, below the fold are some helper functions that implement basic operations for Bayesian linear regression with conjugate priors:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Free stuff!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">blr_nig_update</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y_t</span>, <span class="va">x_t</span>, <span class="va">a</span>, <span class="va">b</span>, <span class="va">m</span>, <span class="va">invH</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Given old prior (a, b, m, invH) and new data point (y, x), compute posterior</span></span>
<span>  <span class="co"># x_t: column vector (p x 1), m: column vector (p x 1), invH: (p x p)</span></span>
<span>  </span>
<span>  <span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">y_t</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">x_t</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">x_t</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">invH</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">x_t</span><span class="op">)</span></span>
<span>  <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">invH</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">x_t</span> <span class="op">/</span> <span class="va">r2</span></span>
<span>  </span>
<span>  <span class="co"># update mean</span></span>
<span>  <span class="va">m_new</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="va">k</span> <span class="op">*</span> <span class="va">e</span></span>
<span>  </span>
<span>  <span class="co"># update covariance</span></span>
<span>  <span class="va">invH_new</span> <span class="op">&lt;-</span> <span class="va">invH</span> <span class="op">-</span> <span class="va">k</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">x_t</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">invH</span></span>
<span>  </span>
<span>  <span class="co"># update shape and scale</span></span>
<span>  <span class="va">a_new</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">+</span> <span class="fl">0.5</span></span>
<span>  <span class="va">b_new</span> <span class="op">&lt;-</span> <span class="va">b</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="op">(</span><span class="va">e</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">r2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">a_new</span>, b <span class="op">=</span> <span class="va">b_new</span>, m <span class="op">=</span> <span class="va">m_new</span>, invH <span class="op">=</span> <span class="va">invH_new</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">blr_1step_predictive</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">a</span>, <span class="va">b</span>, <span class="va">m</span>, <span class="va">invH</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">a</span>, </span>
<span>       ybar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">m</span><span class="op">)</span>, </span>
<span>       s2 <span class="op">=</span> <span class="op">(</span><span class="va">b</span><span class="op">/</span><span class="va">a</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">invH</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">blr_marginal_likelihood</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, <span class="va">mu0</span>, <span class="va">Lambda0</span>, <span class="va">a0</span>, <span class="va">b0</span>, </span>
<span>                                    <span class="va">mu_n</span>, <span class="va">Lambda_n</span>, <span class="va">a_n</span>, <span class="va">b_n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># determinants via Cholesky for stability</span></span>
<span>  <span class="va">det_ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/det.html">determinant</a></span><span class="op">(</span><span class="va">Lambda0</span>, logarithm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">modulus</span> <span class="op">-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/det.html">determinant</a></span><span class="op">(</span><span class="va">Lambda_n</span>, logarithm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">modulus</span></span>
<span>  </span>
<span>  <span class="va">log_ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">lgamma</a></span><span class="op">(</span><span class="va">a_n</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">lgamma</a></span><span class="op">(</span><span class="va">a0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">a0</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">b0</span><span class="op">)</span> <span class="op">-</span> <span class="va">a_n</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">b_n</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fl">0.5</span> <span class="op">*</span> <span class="va">det_ratio</span> <span class="op">-</span></span>
<span>    <span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">log_ml</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>log_marginal_lik <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">log_ml</span><span class="op">)</span>,</span>
<span>              marginal_lik <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">ml</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Using these raw materials, write a simulation study that generates a synthetic time series from a pure MA(1) with <span class="math inline">\(\theta_1=0.99\)</span>. Then, <em>mistakenly</em> fit Bayesian AR(p) to the simulated data using these initial priors:</p>
<p><span class="math display">\[
\begin{aligned}
p&amp;\sim\text{Unif}(\{1,\,2,\,3\})\\
\sigma^2&amp;\sim\text{IG}(1,\,1)\\
\boldsymbol{\beta}\,|\,\sigma^2,\,p&amp;\sim\text{N}_{p+1}\left(\mathbf{0},\,\sigma^2\mathbf{I}_{p+1}\right).
\end{aligned}
\]</span></p>
<p>Starting from these priors, write a for loop that processes the data one observation at a time for each model. Along the way, keep track of the one-step-ahead posterior predictive distributions (non-standard Student’s <span class="math inline">\(t\)</span>), the posterior model probabilities, and the “best” model (the one with highest probability).</p>
<p>At the end of the simulation, construct the histogram of PITs for each of three forecasting distributions:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 53%">
<col style="width: 46%">
</colgroup>
<tbody>
<tr class="odd">
<td>“best” plug-in</td>
<td><span class="math inline">\(\text{N}(\mathbf{x}_t^{\scriptscriptstyle\mathsf{T}}\mathbf{m}_{t-1}, b_{t-1} / a_{t-1})\)</span></td>
</tr>
<tr class="even">
<td>“best” posterior predictive</td>
<td><span class="math inline">\(p(y_t\,|\,y_{1:t-1},\,\hat{p})\)</span></td>
</tr>
<tr class="odd">
<td>model-averaged</td>
<td><span class="math inline">\(\sum_{p=1}^3\text{Pr}(p\,|\,y_{1:t-1})\times p(y_t\,|\,y_{1:t-1},\,p)\)</span></td>
</tr>
</tbody>
</table>
<p>Comment on the calibration of each, and don’t forget that the model we are fitting is fundamentally misspecified.</p>
</section><section id="submission" class="level2"><h2 class="anchored" data-anchor-id="submission">Submission</h2>
<p>You are free to compose your solutions for this problem set however you wish (scan or photograph written work, handwriting capture on a tablet device, LaTeX, Quarto, whatever) as long as the final product is a single PDF file. You must upload this to Gradescope and mark the pages associated with each problem.</p>
<p>Do not forget to include the following:</p>
<ul>
<li>For each problem, please <a href="https://sta542-f25.github.io/syllabus/syllabus.html#collaboration">acknowledge your collaborators</a>;</li>
<li>If a problem required you to code something, please include both the code and the output.</li>
</ul>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/sta542-f25\.github\.io\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2025 John Zito</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>